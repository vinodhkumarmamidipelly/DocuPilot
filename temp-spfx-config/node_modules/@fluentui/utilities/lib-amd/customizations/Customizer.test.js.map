{"version":3,"file":"Customizer.test.js","sourceRoot":"../src/","sources":["customizations/Customizer.test.tsx"],"names":[],"mappings":"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","sourcesContent":["/*  eslint-disable @typescript-eslint/no-deprecated */\nimport * as React from 'react';\nimport { render, screen, act } from '@testing-library/react';\nimport { customizable } from './customizable';\nimport { Customizer } from './Customizer';\nimport { Customizations } from './Customizations';\n\nimport type { JSXElement } from '../jsx';\n\n@customizable('Foo', ['field'])\nclass Foo extends React.Component<{ field?: string }, {}> {\n  public render(): JSXElement {\n    return <div>{this.props.field}</div>;\n  }\n}\n\n@customizable('Bar', ['field', 'field2', 'field3'])\nclass Bar extends React.Component<{ field?: string; field2?: string; field3?: string }, {}> {\n  public render(): JSXElement {\n    return (\n      <div>\n        {this.props.field}\n        {this.props.field2}\n        {this.props.field3}\n      </div>\n    );\n  }\n}\n\ndescribe('Customizer', () => {\n  beforeEach(() => {\n    Customizations.reset();\n  });\n\n  it('can provide new defaults', () => {\n    render(\n      <Customizer settings={{ field: 'customName' }}>\n        <Foo />\n      </Customizer>,\n    );\n    expect(screen.getByText('customName')).toBeInTheDocument();\n  });\n\n  it('can pass through global settings', () => {\n    Customizations.applySettings({ field: 'globalName' });\n\n    render(\n      <Customizer settings={{ nonMatch: 'customName' }}>\n        <Foo />\n      </Customizer>,\n    );\n    expect(screen.getByText('globalName')).toBeInTheDocument();\n  });\n\n  it('can override global settings', () => {\n    Customizations.applySettings({ field: 'globalName' });\n\n    render(\n      <Customizer settings={{ field: 'customName' }}>\n        <Foo />\n      </Customizer>,\n    );\n    expect(screen.getByText('customName')).toBeInTheDocument();\n  });\n\n  it('can scope settings to specific components', () => {\n    const scopedSettings = {\n      Foo: { field: 'scopedToFoo' },\n      Bar: { field: 'scopedToBar' },\n    };\n\n    render(\n      <Customizer scopedSettings={scopedSettings}>\n        <div>\n          <Foo />\n          <Bar />\n        </div>\n      </Customizer>,\n    );\n    expect(screen.getByText('scopedToFoo')).toBeInTheDocument();\n    expect(screen.getByText('scopedToBar')).toBeInTheDocument();\n  });\n\n  it('can layer global settings', () => {\n    render(\n      <Customizer settings={{ field: 'field' }}>\n        <Customizer settings={{ field2: 'field2' }}>\n          <Bar />\n        </Customizer>\n      </Customizer>,\n    );\n    expect(screen.getByText('fieldfield2')).toBeInTheDocument();\n  });\n\n  it('can layer scoped settings', () => {\n    Customizations.applySettings({ field3: 'field3' });\n\n    render(\n      <Customizer scopedSettings={{ Bar: { field: 'field', field2: 'oldfield2' } }}>\n        <Customizer scopedSettings={{ Bar: { field2: 'field2' } }}>\n          <Bar />\n        </Customizer>\n      </Customizer>,\n    );\n    expect(screen.getByText('fieldfield2field3')).toBeInTheDocument();\n  });\n\n  it('can layer scoped settings with scopedSettingsFunction', () => {\n    Customizations.applySettings({ field3: 'field3' });\n\n    render(\n      <Customizer scopedSettings={{ Bar: { field: 'field' } }}>\n        <Customizer\n          scopedSettings={(scopedSettings: { Bar: { field2: string } }) => ({\n            Bar: { ...scopedSettings.Bar, field2: 'field2' },\n          })}\n        >\n          <Bar />\n        </Customizer>\n      </Customizer>,\n    );\n    expect(screen.getByText('fieldfield2field3')).toBeInTheDocument();\n  });\n\n  it('it allows scopedSettings to be merged when a function is passed', () => {\n    render(\n      <Customizer scopedSettings={{ Foo: { field: 'scopedToFoo' } }}>\n        <Customizer\n          scopedSettings={(settings: { Foo: { field: string } }) => ({ ...settings, Bar: { field: 'scopedToBar' } })}\n        >\n          <div>\n            <Foo />\n            <Bar />\n          </div>\n        </Customizer>\n      </Customizer>,\n    );\n    expect(screen.getByText('scopedToFoo')).toBeInTheDocument();\n    expect(screen.getByText('scopedToBar')).toBeInTheDocument();\n  });\n\n  it('overrides previously set settings', () => {\n    render(\n      <Customizer settings={{ field: 'field1' }}>\n        <Customizer settings={{ field: 'field2' }}>\n          <Bar />\n        </Customizer>\n      </Customizer>,\n    );\n    expect(screen.getByText('field2')).toBeInTheDocument();\n  });\n\n  it('overrides the old settings when the parameter is ignored', () => {\n    render(\n      <Customizer settings={{ field: 'field1' }}>\n        <Customizer settings={(settings: { field: string }) => ({ field: 'field2' })}>\n          <Bar />\n        </Customizer>\n      </Customizer>,\n    );\n    expect(screen.getByText('field2')).toBeInTheDocument();\n  });\n\n  it('can use a function to merge settings', () => {\n    render(\n      <Customizer settings={{ field: 'field1' }}>\n        <Customizer settings={(settings: { field: string }) => ({ field: settings.field + 'field2' })}>\n          <Bar />\n        </Customizer>\n      </Customizer>,\n    );\n    expect(screen.getByText('field1field2')).toBeInTheDocument();\n  });\n\n  it('can suppress updates', () => {\n    Customizations.applySettings({ field: 'globalName' });\n\n    render(\n      <Customizer settings={{ nonMatch: 'customName' }}>\n        <Bar />\n      </Customizer>,\n    );\n    // verify base state\n    expect(screen.getByText('globalName')).toBeInTheDocument();\n\n    act(() => {\n      // verify it doesn't update during suppressUpdates(), and it works through errors, and it updates after\n      Customizations.applyBatchedUpdates(() => {\n        Customizations.applySettings({ field: 'notGlobalName' });\n        // it should not update inside\n        expect(screen.getByText('globalName')).toBeInTheDocument();\n        throw new Error();\n      });\n    });\n    // afterwards it should have updated\n    expect(screen.getByText('notGlobalName')).toBeInTheDocument();\n\n    act(() => {\n      // verify it doesn't update during suppressUpdates(), works through errors, and can suppress final update\n      Customizations.applyBatchedUpdates(() => {\n        Customizations.applySettings({ field: 'notUpdated' });\n        // it should not update inside\n        expect(screen.getByText('notGlobalName')).toBeInTheDocument();\n        throw new Error();\n      }, true);\n    });\n    // afterwards, it should still be on the old value\n    expect(screen.getByText('notGlobalName')).toBeInTheDocument();\n\n    // verify it updates after suppressUpdates()\n    act(() => {\n      Customizations.applySettings({ field2: 'lastGlobalName' });\n    });\n    expect(screen.getByText('notUpdatedlastGlobalName')).toBeInTheDocument();\n  });\n});\n"]}